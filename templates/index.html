{% extends 'base.html' %}
<!-- teste -->
{% block content %}
<h1>Esse √© o chatbot</h1>

<div class="container mt-3 d-flex flex-column" style="height: 80vh;">
    <div id="chat-window" class="chat-container d-flex flex-column border rounded bg-white shadow-sm">
        <div class="message bot-msg">
            Ol√°! Bem-vindo √† Gelado no Ponto. üßä<br>
            Deseja um <strong>A√ßa√≠ na Garrafa</strong> ou um <strong>Milkshake</strong> hoje?
        </div>
    </div>

    <div class="input-group mt-3 pb-3">
        <input type="text" id="user-input" class="form-control" placeholder="Digite sua mensagem..." aria-label="Mensagem">
        <button class="btn btn-primary" onclick="sendMessage()" type="button">Enviar</button>
    </div>
</div>

<script>
    async function sendMessage() {
        const input = document.getElementById('user-input');
        const chatWindow = document.getElementById('chat-window');
        const message = input.value.trim();

        if (!message) return;

        // Adiciona mensagem do usu√°rio na tela
        chatWindow.innerHTML += `<div class="message user-msg">${message}</div>`;
        input.value = '';

        // Rola para o fim
        chatWindow.scrollTop = chatWindow.scrollHeight;

        // Chamada fake para o backend
        const response = await fetch('/send_message', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: message })
        });
        
        const data = await response.json();

        // Adiciona resposta do bot
        chatWindow.innerHTML += `<div class="message bot-msg">${data.response}</div>`;
        chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    // Permitir enviar com "Enter"
    document.getElementById('user-input').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') sendMessage();
    });
</script>
{% endblock %}